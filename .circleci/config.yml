version: 2
jobs:
  build:
    docker:
      - image: greysonr/lobby_server:0.0.1

    steps:
      - checkout

      - run:
          name: install
          command: yarn install

      - run:
          name: start
          command: yarn start
          background: true

      - run:
          name: wait_for_server
          command: |
            wget --retry-connrefused --waitretry=1 --read-timeout=20 --timeout=15 -t 10 http://localhost:3000/
            :

      - run:
          name: test
          command: yarn test
